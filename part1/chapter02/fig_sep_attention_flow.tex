\documentclass[tikz,border=10pt]{standalone}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,positioning,calc,patterns,shadows,arrows.meta}

\definecolor{bertblue}{RGB}{66,133,244}
\definecolor{gptgreen}{RGB}{52,168,83}
\definecolor{clsorange}{RGB}{251,188,5}
\definecolor{sepviolet}{RGB}{142,36,245}

\begin{document}
\begin{tikzpicture}[
    token/.style={rectangle, rounded corners=3pt, minimum width=1cm, minimum height=0.6cm, font=\footnotesize},
    attention/.style={->, >=stealth, thick, opacity=0.7},
    label/.style={font=\footnotesize}
]

% Title removed - using figure caption instead

% Input sequence for NLI task
\node[token, fill=clsorange!20] (cls) at (0, 6) {[CLS]};
\node[token, fill=white] (t1) at (1, 6) {The};
\node[token, fill=white] (t2) at (2, 6) {cat};
\node[token, fill=white] (t3) at (3, 6) {sleeps};
\node[token, fill=sepviolet!20] (sep1) at (4, 6) {[SEP]};
\node[token, fill=white] (t4) at (5, 6) {A};
\node[token, fill=white] (t5) at (6, 6) {feline};
\node[token, fill=white] (t6) at (7, 6) {rests};
\node[token, fill=sepviolet!20] (sep2) at (8, 6) {[SEP]};

% Segment labels
\node[label, align=center] at (1.5, 5.3) {Premise\\(Segment A)};
\node[label, align=center] at (6, 5.3) {Hypothesis\\(Segment B)};

% Segment type indicators
\draw[thick, bertblue] (0.2, 5.7) -- (3.8, 5.7);
\draw[thick, gptgreen] (4.2, 5.7) -- (7.8, 5.7);
\node[label, bertblue] at (2, 5.5) {Type 0};
\node[label, gptgreen] at (6, 5.5) {Type 1};

% Self-attention within segments
% Premise self-attention
\draw[attention, bertblue, bend left=30] (t1) to (t2);
\draw[attention, bertblue, bend left=30] (t2) to (t3);
\draw[attention, bertblue, bend right=30] (t3) to (t1);

% Hypothesis self-attention  
\draw[attention, gptgreen, bend left=30] (t4) to (t5);
\draw[attention, gptgreen, bend left=30] (t5) to (t6);
\draw[attention, gptgreen, bend right=30] (t6) to (t4);

% Cross-segment attention through SEP
\draw[attention, sepviolet, very thick, bend left=45] (t2) to (sep1);
\draw[attention, sepviolet, very thick, bend left=45] (sep1) to (t5);
\draw[attention, sepviolet, very thick, bend right=45] (t5) to (sep1);
\draw[attention, sepviolet, very thick, bend right=45] (sep1) to (t2);

% CLS attention to both segments
\draw[attention, clsorange, bend left=20] (cls) to (t2);
\draw[attention, clsorange, bend left=40] (cls) to (sep1);
\draw[attention, clsorange, bend left=60] (cls) to (t5);

% Cross-segment semantic connections
\draw[attention, red, dashed, very thick, bend left=60] (t2) to (t5);
\draw[attention, red, dashed, very thick, bend left=60] (t3) to (t6);

% Attention matrix visualization
\node[rectangle, draw=black, fill=gray!10, minimum width=4cm, minimum height=3cm] at (4, 3.5) {};
\node[font=\small\bfseries] at (4, 4.8) {Attention Matrix Heatmap};

% Create grid for attention visualization
\foreach \i in {0,...,8} {
    \foreach \j in {0,...,8} {
        \pgfmathsetmacro{\opacityval}{0.1 + 0.05*(\i+\j)}
        \pgfmathsetmacro{\xpos}{2.2+\i*0.2}
        \pgfmathsetmacro{\ypos}{2.2+\j*0.2}
        \node[rectangle, fill=bertblue, opacity=\opacityval, minimum size=0.3cm] at (\xpos, \ypos) {};
    }
}

% Highlight SEP attention patterns
\node[rectangle, fill=sepviolet, minimum width=0.3cm, minimum height=1.8cm] at (3, 3.1) {};
\node[rectangle, fill=sepviolet, minimum width=1.8cm, minimum height=0.3cm] at (3.1, 2.9) {};

% Labels for attention matrix
\node[label, rotate=90] at (1.8, 3.1) {Query Tokens};
\node[label] at (3.1, 1.8) {Key Tokens};
\node[label, sepviolet] at (3.5, 2.5) {SEP};

% Key observations
\node[rectangle, draw=black, fill=gray!5, minimum width=12cm, minimum height=1.5cm] at (4, 1) {};
\node[font=\small\bfseries] at (4, 1.5) {Key Attention Patterns};

\node[label, align=left, text width=3cm] at (1, 0.8) {\textcolor{bertblue}{Within-Segment:}\\Local context\\Syntactic relations};
\node[label, align=left, text width=3cm] at (4, 0.8) {\textcolor{sepviolet}{SEP-Mediated:}\\Cross-segment bridge\\Boundary information};
\node[label, align=left, text width=3cm] at (7, 0.8) {\textcolor{red}{Cross-Segment:}\\Semantic alignment\\Entailment detection};

% Information flow arrows
\draw[->, very thick, bertblue] (1.5, 4.5) -- (1.5, 4);
\node[label, bertblue] at (1.5, 4.2) {Local};

\draw[->, very thick, sepviolet] (4, 4.5) -- (4, 4);
\node[label, sepviolet] at (4, 4.2) {Bridge};

\draw[->, very thick, gptgreen] (6.5, 4.5) -- (6.5, 4);
\node[label, gptgreen] at (6.5, 4.2) {Local};

% Bidirectional flow indicator
\draw[<->, very thick, red] (2, 0.3) -- (6, 0.3);
\node[label, red] at (4, 0.1) {Bidirectional Information Flow};

\end{tikzpicture}
\end{document}