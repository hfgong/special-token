\documentclass[tikz,border=10pt]{standalone}
\usepackage{tikz}
\usepackage{luacode}
\usetikzlibrary{shapes,arrows,positioning,calc,patterns,shadows}
\usetikzlibrary{shapes.geometric,shapes.symbols,shapes.misc}
\usetikzlibrary{matrix,fit,backgrounds,arrows.meta}

\definecolor{bertblue}{RGB}{66,133,244}
\definecolor{gptgreen}{RGB}{52,168,83}
\definecolor{maskred}{RGB}{234,67,53}
\definecolor{clsorange}{RGB}{251,188,5}
\definecolor{sepviolet}{RGB}{142,36,245}
\definecolor{padgray}{RGB}{200,200,200}

\begin{document}
\begin{tikzpicture}[
    token/.style={rectangle, rounded corners=3pt, minimum width=1.2cm, minimum height=0.8cm, font=\small\ttfamily},
    special/.style={token, thick, draw=black!80},
    regular/.style={token, draw=black!40, fill=white},
    embedding/.style={circle, fill=black, inner sep=1.5pt},
    arrow/.style={-{Stealth}, thick},
    label/.style={font=\footnotesize\sffamily}
]

% === SPACING AND ALIGNMENT DOCUMENTATION ===
% Token spacing: 1.3cm horizontal gap between token centers
% Token row: y=4 for all tokens
% Type labels: 0.7cm below tokens (y=3.3)
% Embeddings: 1.5cm below tokens (y=2.5)
% Embedding layer box: centered at y=2.5
% Position embeddings: y=1.0
% Annotations: bottom at y=0
% Legend: right side at x=12.5

% Title
\node[font=\large\bfseries] at (5, 6) {Special Tokens in Transformer Input Sequence};

% Input sequence tokens - evenly spaced with consistent gaps
\node[special, fill=clsorange!20, draw=clsorange!80] (cls) at (0, 4) {[CLS]};
\node[regular, right=0.3cm of cls] (tok1) {The};
\node[regular, right=0.3cm of tok1] (tok2) {cat};
\node[special, fill=maskred!20, draw=maskred!80, right=0.3cm of tok2] (mask) {[MASK]};
\node[regular, right=0.3cm of mask] (tok3) {on};
\node[regular, right=0.3cm of tok3] (tok4) {the};
\node[regular, right=0.3cm of tok4] (tok5) {mat};
\node[special, fill=sepviolet!20, draw=sepviolet!80, right=0.3cm of tok5] (sep) {[SEP]};
\node[special, fill=padgray!40, draw=padgray!80, right=0.3cm of sep] (pad) {[PAD]};

% Token type indicators - aligned below tokens
\node[label, clsorange!80, below=0.2cm of cls] {Aggregation};
\node[label, maskred!80, below=0.2cm of mask] {Placeholder};
\node[label, sepviolet!80, below=0.2cm of sep] {Boundary};
\node[label, padgray!80, below=0.2cm of pad] {Padding};

% Embeddings representation - aligned with tokens
\node[embedding, below=1cm of cls] (emb-cls) {};
\node[embedding, below=1cm of tok1] (emb-1) {};
\node[embedding, below=1cm of tok2] (emb-2) {};
\node[embedding, below=1cm of mask] (emb-mask) {};
\node[embedding, below=1cm of tok3] (emb-3) {};
\node[embedding, below=1cm of tok4] (emb-4) {};
\node[embedding, below=1cm of tok5] (emb-5) {};
\node[embedding, below=1cm of sep] (emb-sep) {};
\node[embedding, below=1cm of pad] (emb-pad) {};

% Arrows from tokens to embeddings
\draw[arrow, black!40] (cls.south) -- (emb-cls);
\draw[arrow, black!40] (tok1.south) -- (emb-1);
\draw[arrow, black!40] (tok2.south) -- (emb-2);
\draw[arrow, black!40] (mask.south) -- (emb-mask);
\draw[arrow, black!40] (tok3.south) -- (emb-3);
\draw[arrow, black!40] (tok4.south) -- (emb-4);
\draw[arrow, black!40] (tok5.south) -- (emb-5);
\draw[arrow, black!40] (sep.south) -- (emb-sep);
\draw[arrow, black!40] (pad.south) -- (emb-pad);

% Embedding layer
\node[rectangle, draw=black!60, fill=bertblue!10, minimum width=11cm, minimum height=0.6cm] at (5.1, 2.5) {};
\node[label] at (5.1, 2.5) {Embedding Layer};

% Self-attention connections (simplified) - all tokens attend to CLS
\draw[arrow, bertblue!40, densely dotted] (emb-1) to[bend left=20] (emb-cls);
\draw[arrow, bertblue!40, densely dotted] (emb-2) to[bend left=20] (emb-cls);
\draw[arrow, bertblue!40, densely dotted] (emb-mask) to[bend left=20] (emb-cls);
\draw[arrow, bertblue!40, densely dotted] (emb-3) to[bend left=20] (emb-cls);
\draw[arrow, bertblue!40, densely dotted] (emb-4) to[bend left=20] (emb-cls);
\draw[arrow, bertblue!40, densely dotted] (emb-5) to[bend left=20] (emb-cls);
\draw[arrow, bertblue!40, densely dotted] (emb-sep) to[bend left=20] (emb-cls);

% Attention flow to CLS label
\node[label, bertblue!80, below=0.2cm of emb-cls] (agg-label) {Aggregates\\Information};

% Position embeddings
\node[rectangle, draw=black!40, fill=gptgreen!10, minimum width=11cm, minimum height=0.3cm] at (5.1, 1.0) {};
\node[label, font=\footnotesize\sffamily] at (5.1, 1.0) {+ Position Embeddings};

% Legend box
\node[rectangle, draw=black!50, fill=gray!5, minimum width=4cm, minimum height=2cm] at (12.5, 2.5) {};
\node[font=\small\bfseries] at (12.5, 3.3) {Token Types};
\node[special, fill=clsorange!20, draw=clsorange!80, scale=0.7] at (11.8, 2.8) {[CLS]};
\node[label, align=left] at (13.2, 2.8) {Classification};
\node[special, fill=maskred!20, draw=maskred!80, scale=0.7] at (11.8, 2.3) {[MASK]};
\node[label, align=left] at (13.2, 2.3) {Masked};
\node[special, fill=sepviolet!20, draw=sepviolet!80, scale=0.7] at (11.8, 1.8) {[SEP]};
\node[label, align=left] at (13.2, 1.8) {Separator};
\node[regular, scale=0.7] at (11.8, 1.3) {word};
\node[label, align=left] at (13.2, 1.3) {Regular};

% Annotations - positioned relative to embeddings
\node[label, align=center, below=1.5cm of emb-cls] (cls-ann) {Used for\\Classification};
\draw[arrow, black!60] (cls-ann.north) -- (emb-cls.south);

\node[label, align=center, below=1.5cm of emb-mask] (mask-ann) {Predicted\\During MLM};
\draw[arrow, black!60] (mask-ann.north) -- (emb-mask.south);

\node[label, align=center, below=1.5cm of emb-pad] (pad-ann) {Ignored in\\Attention};
\draw[arrow, black!60] (pad-ann.north) -- (emb-pad.south);

\end{tikzpicture}
\end{document}